<!DOCTYPE html>
<html lang="es-ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale = 1.0" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="./error.txt" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <title>TP7 - HTML</title>
    <style>
      input[id="edad"] {
        width: 30px;
      }
    </style>
  </head>

  <body>
    <h1>TP7 - HTML, CSS, Javascript, Jquery</h1>
    <p>Este es el <em>TP7</em> de la capacitación</p>

    <form id="formulario" style="width: 50%; max-width: 300px">
      <br />
      <h2>Contacto</h2>
      <p class="formbody">Unite a mi club de fans!</p>
      <br />

      <h3>Información Personal</h3>
      <hr id="hr1" />
      <br />
      <label for="nombre">Nombre:</label><br />
      <input
        type="text"
        name="Nombre"
        id="nombre"
        oninput="this.value = this.value.replace(/[^a-zA-Z ]/, '')"
        maxlength="50"
      />
      <div class="error" id="error1"><br /></div>

      <label for="apellido">Apellido:</label><br />
      <input
        type="text"
        name="apellido"
        id="apellido"
        maxlength="50"
        oninput="this.value = this.value.replace(/[^a-zA-Z ]/, '')"
      />
      <div class="error" id="error2"><br /></div>

      <label for="edad">Edad:</label><br />
      <input
        type="text"
        name="edad"
        id="edad"
        maxlength="3"
        oninput="this.value = this.value.replace(/[^0-9]/, '')"
      /><br /><br />
      <input type="radio" id="masculino" name="sexo" value="masculino" />

      <label for="masculino">Masculino</label><br />
      <input type="radio" id="femenino" name="sexo" value="female" />
      <label for="femenino">Femenino</label><br />
      <input type="radio" id="otro" name="sexo" value="other" />
      <label for="otro">Otro</label><br /><br />

      <h4>Información Adicional</h4>
      <hr id="hr2" />
      <br />
      <label for="empresa">Empresa:</label><br />
      <input
        type="text"
        name="empresa"
        id="empresa"
        oninput="this.value = this.value.replace(/[^a-zA-Z ]/, '')"
        maxlength="50"
      /><br /><br /><br />

      <input type="submit" value="Enviar" id="submit" />
      <input type="button" id="but_clear" value="Limpiar" /><br /><br />
    </form>

    <script>
      $(document).ready(function () {
        $("#but_clear").click(function () {
          $(":text").val("");
          $(":radio").prop("checked", false);
          $(".error").empty();
          $(":text").css("background-color", "rgb(190, 190, 190)");
        });

        $(document).on("click", "#submit", function (event) {
          var error = false;
          $("#error1").empty();
          $("#error2").empty();
          if (!$.fn.validar("#nombre")) {
            //Error: Funcion load no esta linqueando el archivo error.txt a menos que se ejecute el html en un server
            //Solucion: reemplace la funcion load por append
            //$("#error1").load("error.txt");
            $("#error1").append("<p class=m_error id=m_error1>*Este campo es obligatorio</p>");
            error = true;
          }
          if (!$.fn.validar("#apellido")) {
            //$("#error2").load("error.txt");
            $("#error2").append("<p class=m_error id=m_error2>*Este campo es obligatorio</p>");
            error = true;
          }
          if (error) return false;

          //No pude hacer andar la respuesta desde el .php 
          // event.preventDefault();
          // var name = $("#nombre").val();
          // var apellido = $("#apellido").val();
          //   $.ajax({
          //     url     : 'savejson.php',
          //     method  : 'post',
          //     data    : { $("#formulario").serialize() },
          //     success : function( response ) {
          //         alert("exito!"+ response );
          //     },
          //     error : function(response){
          //       alert("hubo un error"+response)
          //     }
          // });
          return true;
        });
        $.fn.validar = function (e) {
          if ($(e).val().length == 0) {
            $(e).css("background-color", "yellow");
            return false;
          }
          $(e).css("background-color", "rgb(190, 190, 190)");
          return true;
        };

        $(window).bind('beforeunload',function(){
          $(":text").val("");
          $(":radio").prop("checked", false);
          $(".error").empty();
          $(":text").css("background-color", "rgb(190, 190, 190)");
        });
      });
    </script>
  </body>
</html>
